---
title: "Next.js App Router: The Complete Guide"
description: "Learn the Next.js 14 App Router - file-based routing, layouts, server components, and data fetching patterns."
date: "2024-02-15"
category: "nextjs"
tags: ["nextjs", "react", "app-router", "server-components", "ssr"]
slug: "nextjs-app-router-guide"
author: "Your Name"
published: true
---

# Next.js App Router: The Complete Guide

The App Router is the new routing system in Next.js 13+, bringing React Server Components, nested layouts, and simplified data fetching to the framework.

## File-Based Routing

The App Router uses a file-system based router where folders define routes:

```
app/
├── page.tsx          → /
├── about/
│   └── page.tsx      → /about
├── blog/
│   ├── page.tsx      → /blog
│   └── [slug]/
│       └── page.tsx  → /blog/:slug
└── layout.tsx        → Root layout
```

## Layouts

Layouts wrap pages and preserve state across navigation:

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <nav>Navigation here</nav>
        <main>{children}</main>
        <footer>Footer here</footer>
      </body>
    </html>
  );
}
```

### Nested Layouts

```tsx
// app/blog/layout.tsx
export default function BlogLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="blog-container">
      <aside>Blog sidebar</aside>
      <article>{children}</article>
    </div>
  );
}
```

## Server Components (Default)

By default, all components in the App Router are Server Components:

```tsx
// This runs on the server!
async function BlogList() {
  // Direct database access - no API needed
  const posts = await db.posts.findMany();

  return (
    <ul>
      {posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
```

### Client Components

Add interactivity with the `'use client'` directive:

```tsx
'use client';

import { useState } from 'react';

export function Counter() {
  const [count, setCount] = useState(0);

  return (
    <button onClick={() => setCount(count + 1)}>
      Count: {count}
    </button>
  );
}
```

## Data Fetching

### Server Components (Recommended)

```tsx
async function Page() {
  const data = await fetch('https://api.example.com/data', {
    cache: 'force-cache', // Static (default)
    // cache: 'no-store', // Dynamic
    // next: { revalidate: 60 }, // ISR
  });

  return <div>{JSON.stringify(data)}</div>;
}
```

### Dynamic Routes

```tsx
// app/blog/[slug]/page.tsx
interface PageProps {
  params: Promise<{ slug: string }>;
}

export async function generateStaticParams() {
  const posts = await getPosts();
  return posts.map(post => ({
    slug: post.slug,
  }));
}

export default async function Page({ params }: PageProps) {
  const { slug } = await params;
  const post = await getPostBySlug(slug);

  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </article>
  );
}
```

## Metadata

SEO-friendly metadata generation:

```tsx
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'My Blog',
  description: 'Welcome to my blog',
  openGraph: {
    title: 'My Blog',
    description: 'Welcome to my blog',
    images: ['/og-image.png'],
  },
};

// Dynamic metadata
export async function generateMetadata({ params }): Promise<Metadata> {
  const post = await getPost(params.slug);
  
  return {
    title: post.title,
    description: post.excerpt,
  };
}
```

## Loading and Error States

### Loading UI

```tsx
// app/blog/loading.tsx
export default function Loading() {
  return (
    <div className="animate-pulse">
      <div className="h-8 bg-gray-200 rounded w-3/4 mb-4" />
      <div className="h-4 bg-gray-200 rounded w-full mb-2" />
      <div className="h-4 bg-gray-200 rounded w-5/6" />
    </div>
  );
}
```

### Error Handling

```tsx
// app/blog/error.tsx
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div>
      <h2>Something went wrong!</h2>
      <p>{error.message}</p>
      <button onClick={reset}>Try again</button>
    </div>
  );
}
```

## Route Handlers (API Routes)

```tsx
// app/api/posts/route.ts
import { NextResponse } from 'next/server';

export async function GET() {
  const posts = await getPosts();
  return NextResponse.json(posts);
}

export async function POST(request: Request) {
  const body = await request.json();
  const post = await createPost(body);
  return NextResponse.json(post, { status: 201 });
}
```

## Summary

| Feature | Description |
|---------|-------------|
| File-based routing | Folders define routes |
| Layouts | Shared UI that preserves state |
| Server Components | Default - run on server |
| Client Components | `'use client'` for interactivity |
| Loading/Error | Automatic loading and error states |
| Metadata | Built-in SEO support |

The App Router is the future of Next.js development, offering better performance and developer experience!
